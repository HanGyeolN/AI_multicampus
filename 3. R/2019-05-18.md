```R
library(foreign)
library(readxl)
library(ggplot2)
library(dplyr)
raw_welfare<-read.spss(file="Data/koweps.sav", to.data.frame = T)
welfare<-raw_welfare
str(welfare)
View(welfare)
summary(welfare)

welfare<-rename(welfare,
                sex=h10_g3,  #성별
                birth=h10_g4, #연도
                marriage=h10_g10, #혼인여부
                religion=h10_g11, #종교
                income=p1002_8aq1, #급여
                code_job=h10_eco9, #직종코드
                code_region=h10_reg7) #지역 코드드
str(welfare) 

#성별에 따라 월급 차이?
class(welfare$sex)
table(welfare$sex)
#성별에 0이 들어가 있는 경우에는 NA로 처리
#welfare$sex<-ifelse(welfare$sex==0,NA,welfare$sex)

table(is.na(welfare$sex))

welfare$sex<-ifelse(welfare$sex==1,"male","female")
table(welfare$sex)

qplot(welfare$sex)

class(welfare$income)
summary(welfare$income)

qplot(welfare$income)+
  xlim(0,1000)

#0, 9999
welfare$income<-ifelse(welfare$income %in% c(0,9999), NA, welfare$income)

table(is.na(welfare$income))
#na : 12030 => 12044

#성별에 따른 월급 차이 분석하기
sex_income<-welfare %>% 
  filter(!is.na(income)) %>% 
  group_by(sex) %>% 
  summarise(meanIncome=mean(income))

sex_income
ggplot(data=sex_income, aes(x=sex, y=meanIncome))+  geom_col()

#몇 살때 최고급여?
summary(welfare$birth)
table(is.na(welfare$birth))

welfare$birth<-ifelse(welfare$birth==9999, NA, welfare$birth)
table(is.na(welfare$birth))

welfare$age<- 2019-welfare$birth+1

welfare$age

welfare<-welfare %>% 
  mutate(ageg=ifelse(age<30,"young",
                     ifelse(age<=59,
                            "middle","old")))
table(welfare$ageg)
qplot(welfare$ageg)


ageg_income<-welfare %>% 
  filter(!is.na(income)) %>% 
  group_by(ageg) %>% 
  summarise(meanIncome=mean(income))

ggplot(data=ageg_income, 
       aes(x=ageg, y=meanIncome))+
  geom_col()

#나이순으로 정렬하여 출력
ggplot(data=ageg_income, 
       aes(x=ageg, y=meanIncome))+
  geom_col()+
  scale_x_discrete(limits=c("young", "middle", "old"))

#성별 월급 차이는 연령대별로 차이?

sex_income<-welfare %>% 
  filter(!is.na(income)) %>% 
  group_by(ageg, sex) %>% 
  summarise(meanIncome=mean(income))
sex_income

ggplot(data=sex_income, aes(x=ageg, y=meanIncome, fill=sex))+
  geom_col()+
  scale_x_discrete(limits=c("young", "middle", "old"))

ggplot(data=sex_income, aes(x=ageg, y=meanIncome, fill=sex))+
  geom_col(position = "dodge")+
  scale_x_discrete(limits=c("young", "middle", "old"))


###2일차 과제 풀이###

#1~4
library(ggplot2)
mpg_new<-as.data.frame(mpg)
mpg_new<-mpg_new %>% mutate(total=cty+hwy)
mpg_new

mpg_new<-mpg_new %>% mutate(mymean=total/2)

mpg_new %>% 
  arrange(desc(mymean)) %>% 
  head(3)


mpg %>% 
  mutate(total=cty+hwy,
         mymean=total/2) %>%
  arrange(desc(mymean)) %>%
  head(3)
class(mpg)
#5~8
mpg<-as.data.frame(mpg)
mpg %>% 
  group_by(class) %>% 
  summarise(meanCty=mean(cty)) %>% 
  arrange(desc(meanCty))

mpg %>% 
  group_by(manufacturer) %>% 
  summarise(meanHwy=mean(hwy)) %>% 
  arrange(desc(meanHwy)) %>% 
  head(5)

mpg %>% 
  filter(class=="compact") %>% 
  group_by(manufacturer) %>% 
  summarise(count=n()) %>% 
  arrange(desc(count))

midwest<-as.data.frame(midwest)
str(midwest)

midwest<-midwest %>% 
  mutate(ratio_child=(poptotal-popadults)/poptotal*100)

midwest %>% 
  arrange(desc(ratio_child)) %>% 
  select(county, ratio_child) %>% 
  head(5)

midwest<-midwest %>% 
  mutate(grade=ifelse(ratio_child>=40,"large",ifelse(ratio_child>=30,"middle","small")))
table(midwest$grade)

midwest %>% 
  mutate(ratio_asian=(popasian/poptotal)*100) %>% 
  arrange(ratio_asian) %>% 
  select(state, county, ratio_asian) %>% 
  head(10)

#9~
mpg <- as.data.frame(ggplot2::mpg) # mpg 데이터 불러오기 
mpg[c(65, 124, 131, 153, 212), "hwy"] <- NA # NA 할당하기

table(is.na(mpg$drv))
table(is.na(mpg$hwy))

mpg %>% 
  filter(!is.na(hwy)) %>% 
  group_by(drv) %>% 
  summarise(meanHway=mean(hwy))

mpg <- as.data.frame(ggplot2::mpg) # mpg 데이터 불러오기 
mpg[c(10, 14, 58, 93), "drv"] <- "k" # drv 이상치 할당 
mpg[c(29, 43, 129, 203), "cty"] <- c(3, 4, 39, 42) # cty 이상치 할당

table(mpg$drv)
mpg$drv<-ifelse(mpg$drv %in% c("f","r","4"),mpg$drv,NA) 
#"f" %in% c("f","r","4") =>TRUE
#"k" %in% c("f","r","4") =>FALSE
table(mpg$drv)

boxplot(mpg$cty)$stats

mpg$cty<-ifelse(mpg$cty<9 | mpg$cty>26,NA,mpg$cty)
boxplot(mpg$cty)

mpg %>% 
  filter(!is.na(drv) & !is.na(cty)) %>% 
  group_by(drv) %>% 
  summarise(meanCty=mean(cty))
  ```
