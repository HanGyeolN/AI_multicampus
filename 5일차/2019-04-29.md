## 복습

Azure DNS는 PaaS 서비스

라우터라는 장비가 서브넷의 바운더리를 만들어주기 때문에

서브넷은 반드시 라우터가 필요함

자동으로 라우팅이됨.

안쪽의 IP는 공인IP보다는 사설IP를 씀

사설IP의 범위를 알아둬야함

172.16.0.0 ~ 172.31.255.255 (책에 나와있는거 오타났음)

## 피어링 실습

피어링은 공인 시험에서 굉장히 자주 등장하는 주제임

파워쉘과 CLI 둘다 알아야 함.

대량 관리, 자동화를 할 때 CLI를 씀

### 파워쉘
windows PowerShell은 5.1버전, powershell core는 6.0버전

Powershell ISE가 있음(powershell_ise.exe) <== GUI로 되어있고 스크립트로 만들 수 있음

windows PowerShell console(powershell.exe)

파워쉘은 모듈로 되어 있음

파워쉘의 명령어들의 집합을 모듈이라고 함

애져 파워쉘 모듈을 설치해야 애져 파워쉘 모듈을 사용할 수 있음

버전이 올라가면서 GUI화면이 점점 지원이 되고 있음

> $env:PSModulePath

$ 자리에 변수 명이 들어가고, 오른쪽은 값이 들어감

azure powershellmodule들은 다음과 같다.

각각 임포트 해줘야지 사용할 수 있음

- azure resource manager
- azure service management
- azure active directory
- azure rights management
- azure service fabric

로컬에서 사용하면 저런 것을 신경써줘야 함

하지만, 클라우드에서 쉘을 사용한다면 저런 것들을 신경 안써줘도 됨.

### 파워쉘 설치방법
- PowerShellGet: 파워쉘은 윈도우와 리눅스, 맥에서도 사용이 가능함.
- powershell web PI(windows only)
- MSI packages(Windows only)


## azure subscriptions를 관리하기(azure powershell을 사용해서)

PowerShell의 명령어의 형태는 동사-명사 형태로 되어 있음

### Azure Resource Manager
인증을 받아야함

- 인증
  - `Connect-AzureRmAccount`(매우 중요) : 인증하기

- Azure subscription을 선택하기
  - `Get-AzureRmSubscription`(매우 중요): 서브스크립션 보기
  - `Select-AzureRmSubscription`(매우 중요): 서브스크립션 선택

파워쉘에서 azure의 인증을 받아야 사용 가능함

rm이 항상 붙는 것은 리소스 매니저의 명령어이다 !!

ex. Get-AzureRmSubscription

Get-AzureSubscription(이런 식으로 붙은 것은 클래식 명령어이다)



### Service Management (classic) 구 서비스


## Azure-CLI - powershell보다 명령어가 쉽고 단순하게 되어있음
1.0은 azure로 시작되고, ARM과 클래식 둘 다 지원됨
2.0은 az로 시작됨, ARM만 지원됨

linux shell scripting 툴과 통합 사용돔

### 인증하기
azure login(v1) or az login(v2)

http://aka.ms/devicelogin (장치인증)

### 모드 바꾸기(v1 only)
- azure config mode arm
- azure config mode asm



## 파워쉘 실습


파워쉘은 기본적으로 관리자로 들어가야 함

윈도우 시작키 > powershell

파워쉘을 작업관리자에 등록

파워쉘만 등록하면 파워쉘-ISE도 자동으로 등록이 됨. 오른쪽 키 눌러서 관리자 모드로 시작하면 됨

> $env:PSModulePath

![](img/1.png)

위의 경로에 모듈들이 설치되어 있음

tab을 누르면 자동완성기능이 있음

get-command (powershell에서 사용할 수 있는 모든 옵션을 사용할 수 있음)

get-command | more (파이프라인 사용 가능)

`get-help get-process`: help 보기. 업데이트를 먼저 하고 실행함

![](img/2.png)

도스는 명령어 넣고 `/?`하면 되는데 파워쉘은 위의 방식으로 해야함.

`cls`: 화면 지우기

`Get-Process`: 메모리에 올라가 있는 앱들을 볼 때.

`Get-Module`: 현재 설치되어 있는 모듈

`add-azureAccount`: 현재 이 명령어를 실행하면, 모듈이 등록되어 있지 않기 때문에 실행이 안됨

`add-azureRmAccount`: 이 명령어도 실행이 현재 되지 않음

### PowerShell ISE

스크립트 창을 띄우기 > 보기 > 스크립트 창 표시(Ctrl + R)

위에 있는 창을 스크립트 창, 아래에 있는 창을 콘솔 창이라고 함

블럭을 잡고 선택 > F8하면 선택된 영역만 실행

F5 하면 전체 실행

스크립트를 저장

주석은 `# 주석입니다`

`Test-AppLockerPolicy`: 

### powershell의 Azure 모듈 설치

[다운로드-페이지](https://azure.microsoft.com/ko-kr/downloads/)

위의 사이트에서 하단에 ![](img/3.png)

파워쉘 > 설치에 들어가서 다운로드

[다운로드](https://docs.microsoft.com/ko-kr/powershell/azure/install-az-ps?view=azps-1.8.0&viewFallbackFrom=azps-1.2.0)

`Install-Module -Name Az -AllowClobber`: 이 명령어를 복사해서 실행

예, 모두 예 눌러서 설치

그 명령어의 아래쪽에 보면 관리자 권한이 없는 사람은 현재 사용자에만 설치할 것이냐 묻는데, 기본으로 관리자 권한으로 설치하고, 안되면 현재 유저에 설치

`Connect-AzAccount`: 이 명령어를 실행하기 위해서는 import-module을 먼저 해야 함

`import-module AzAccount`: 하지만 모듈을 임포트 하려고 해도 보안 오류가 뜸

`Get-ExecutionPolicy`: 이렇게 보면 restricted로 되어 있기 때문에

`Set-ExecutionPolicy Unrestricted`: 이 명령어로 보안정책을 먼저 변경함

![](img/4.png)

현재 상태는 azure에 마이크로 소프트 계정이 연결된 상태임.

> 교재랑 약간 상이한 부분

`Connect-AzAccount`: 이 부분이 최신임.